<!DOCTYPE html>
<html>
  <head>
    <title>Test Upload</title>
  </head>
  <body>
    <h1>Test File Upload</h1>
    <form id="uploadForm">
      <input type="file" id="fileInput" accept=".pdf" />
      <button type="submit">Upload</button>
    </form>
    <div id="status"></div>
    <div id="progress"></div>

    <script>
      const form = document.getElementById("uploadForm");
      const fileInput = document.getElementById("fileInput");
      const statusDiv = document.getElementById("status");
      const progressDiv = document.getElementById("progress");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const file = fileInput.files[0];
        if (!file) {
          alert("Please select a file");
          return;
        }

        const formData = new FormData();
        formData.append("file", file);

        try {
          // Upload file
          statusDiv.textContent = "Uploading...";
          const uploadResponse = await fetch(
            "http://localhost:8000/api/v1/translate/upload",
            {
              method: "POST",
              body: formData,
            }
          );

          const uploadData = await uploadResponse.json();
          console.log("Upload response:", uploadData);

          if (!uploadResponse.ok) {
            throw new Error(uploadData.detail || "Upload failed");
          }

          const jobId = uploadData.job_id;
          statusDiv.textContent = `Job ID: ${jobId}`;

          // Poll for status
          const pollInterval = setInterval(async () => {
            try {
              const statusResponse = await fetch(
                `http://localhost:8000/api/v1/translate/status/${jobId}`
              );
              const statusData = await statusResponse.json();

              console.log("Status:", statusData);
              progressDiv.textContent = `Progress: ${statusData.progress}% - Status: ${statusData.status}`;

              if (
                statusData.status === "completed" ||
                statusData.status === "failed"
              ) {
                clearInterval(pollInterval);
                statusDiv.textContent = `Final status: ${statusData.status}`;
              }
            } catch (error) {
              console.error("Status poll error:", error);
            }
          }, 1000);
        } catch (error) {
          console.error("Upload error:", error);
          statusDiv.textContent = `Error: ${error.message}`;
        }
      });
    </script>
  </body>
</html>
